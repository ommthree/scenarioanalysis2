{
  "template_code": "CORP_CF_001",
  "template_name": "Corporate Cash Flow Statement (Indirect Method)",
  "statement_type": "CF",
  "industry": "CORPORATE",
  "version": "1.0.0",
  "description": "Standard indirect method cash flow statement starting with net income",
  "line_items": [
    {
      "code": "NET_INCOME",
      "display_name": "Net Income",
      "level": 1,
      "formula": "pl:NET_INCOME",
      "base_value_source": null,
      "driver_applicable": false,
      "driver_code": null,
      "category": "operating",
      "is_computed": true,
      "dependencies": ["pl:NET_INCOME"],
      "comment": "Starting point for indirect method"
    },
    {
      "code": "DEPRECIATION",
      "display_name": "Add: Depreciation",
      "level": 2,
      "formula": "pl:DEPRECIATION",
      "base_value_source": null,
      "driver_applicable": false,
      "driver_code": null,
      "category": "operating",
      "is_computed": true,
      "dependencies": ["pl:DEPRECIATION"],
      "comment": "Add back non-cash expense"
    },
    {
      "code": "AMORTIZATION",
      "display_name": "Add: Amortization",
      "level": 2,
      "formula": "pl:AMORTIZATION",
      "base_value_source": null,
      "driver_applicable": false,
      "driver_code": null,
      "category": "operating",
      "is_computed": true,
      "dependencies": ["pl:AMORTIZATION"],
      "comment": "Add back non-cash expense"
    },
    {
      "code": "CHANGE_ACCOUNTS_RECEIVABLE",
      "display_name": "Change in Accounts Receivable",
      "level": 2,
      "formula": "bs:ACCOUNTS_RECEIVABLE[t-1] - bs:ACCOUNTS_RECEIVABLE",
      "base_value_source": null,
      "driver_applicable": false,
      "driver_code": null,
      "category": "operating",
      "is_computed": true,
      "dependencies": ["bs:ACCOUNTS_RECEIVABLE"],
      "comment": "Decrease in AR (t-1 > t) increases cash"
    },
    {
      "code": "CHANGE_INVENTORY",
      "display_name": "Change in Inventory",
      "level": 2,
      "formula": "bs:INVENTORY[t-1] - bs:INVENTORY",
      "base_value_source": null,
      "driver_applicable": false,
      "driver_code": null,
      "category": "operating",
      "is_computed": true,
      "dependencies": ["bs:INVENTORY"],
      "comment": "Decrease in inventory increases cash"
    },
    {
      "code": "CHANGE_PREPAID_EXPENSES",
      "display_name": "Change in Prepaid Expenses",
      "level": 2,
      "formula": "bs:PREPAID_EXPENSES[t-1] - bs:PREPAID_EXPENSES",
      "base_value_source": null,
      "driver_applicable": false,
      "driver_code": null,
      "category": "operating",
      "is_computed": true,
      "dependencies": ["bs:PREPAID_EXPENSES"],
      "comment": "Decrease in prepaid increases cash"
    },
    {
      "code": "CHANGE_ACCOUNTS_PAYABLE",
      "display_name": "Change in Accounts Payable",
      "level": 2,
      "formula": "bs:ACCOUNTS_PAYABLE - bs:ACCOUNTS_PAYABLE[t-1]",
      "base_value_source": null,
      "driver_applicable": false,
      "driver_code": null,
      "category": "operating",
      "is_computed": true,
      "dependencies": ["bs:ACCOUNTS_PAYABLE"],
      "comment": "Increase in AP (t > t-1) increases cash"
    },
    {
      "code": "CHANGE_ACCRUED_EXPENSES",
      "display_name": "Change in Accrued Expenses",
      "level": 2,
      "formula": "bs:ACCRUED_EXPENSES - bs:ACCRUED_EXPENSES[t-1]",
      "base_value_source": null,
      "driver_applicable": false,
      "driver_code": null,
      "category": "operating",
      "is_computed": true,
      "dependencies": ["bs:ACCRUED_EXPENSES"],
      "comment": "Increase in accruals increases cash"
    },
    {
      "code": "CF_OPERATING",
      "display_name": "Net Cash from Operating Activities",
      "level": 0,
      "formula": "NET_INCOME + DEPRECIATION + AMORTIZATION + CHANGE_ACCOUNTS_RECEIVABLE + CHANGE_INVENTORY + CHANGE_PREPAID_EXPENSES + CHANGE_ACCOUNTS_PAYABLE + CHANGE_ACCRUED_EXPENSES",
      "base_value_source": null,
      "driver_applicable": false,
      "driver_code": null,
      "category": "subtotal",
      "is_computed": true,
      "dependencies": ["NET_INCOME", "DEPRECIATION", "AMORTIZATION", "CHANGE_ACCOUNTS_RECEIVABLE", "CHANGE_INVENTORY", "CHANGE_PREPAID_EXPENSES", "CHANGE_ACCOUNTS_PAYABLE", "CHANGE_ACCRUED_EXPENSES"]
    },
    {
      "code": "CAPEX",
      "display_name": "Capital Expenditures",
      "level": 2,
      "formula": "-(bs:PPE_GROSS - bs:PPE_GROSS[t-1] - driver:ASSET_DISPOSALS)",
      "base_value_source": null,
      "driver_applicable": true,
      "driver_code": "ASSET_DISPOSALS",
      "category": "investing",
      "is_computed": true,
      "dependencies": ["bs:PPE_GROSS", "driver:ASSET_DISPOSALS"],
      "comment": "Negative = cash outflow. Adjusted for disposals"
    },
    {
      "code": "ASSET_SALE_PROCEEDS",
      "display_name": "Proceeds from Asset Sales",
      "level": 2,
      "formula": "driver:ASSET_DISPOSALS",
      "base_value_source": "driver:ASSET_DISPOSALS",
      "driver_applicable": true,
      "driver_code": "ASSET_DISPOSALS",
      "category": "investing",
      "is_computed": false,
      "dependencies": [],
      "comment": "Cash received from selling assets"
    },
    {
      "code": "CF_INVESTING",
      "display_name": "Net Cash from Investing Activities",
      "level": 0,
      "formula": "CAPEX + ASSET_SALE_PROCEEDS",
      "base_value_source": null,
      "driver_applicable": false,
      "driver_code": null,
      "category": "subtotal",
      "is_computed": true,
      "dependencies": ["CAPEX", "ASSET_SALE_PROCEEDS"]
    },
    {
      "code": "DEBT_ISSUANCE",
      "display_name": "Debt Proceeds",
      "level": 2,
      "formula": "MAX(bs:LONG_TERM_DEBT + bs:SHORT_TERM_DEBT - (bs:LONG_TERM_DEBT[t-1] + bs:SHORT_TERM_DEBT[t-1]), 0)",
      "base_value_source": null,
      "driver_applicable": false,
      "driver_code": null,
      "category": "financing",
      "is_computed": true,
      "dependencies": ["bs:LONG_TERM_DEBT", "bs:SHORT_TERM_DEBT"],
      "comment": "Positive debt changes only"
    },
    {
      "code": "DEBT_REPAYMENT",
      "display_name": "Debt Repayment",
      "level": 2,
      "formula": "MIN(bs:LONG_TERM_DEBT + bs:SHORT_TERM_DEBT - (bs:LONG_TERM_DEBT[t-1] + bs:SHORT_TERM_DEBT[t-1]), 0)",
      "base_value_source": null,
      "driver_applicable": false,
      "driver_code": null,
      "category": "financing",
      "is_computed": true,
      "dependencies": ["bs:LONG_TERM_DEBT", "bs:SHORT_TERM_DEBT"],
      "comment": "Negative debt changes only (cash outflow)"
    },
    {
      "code": "DIVIDENDS_PAID",
      "display_name": "Dividends Paid",
      "level": 2,
      "formula": "-driver:DIVIDENDS_PAID",
      "base_value_source": "driver:DIVIDENDS_PAID",
      "driver_applicable": true,
      "driver_code": "DIVIDENDS_PAID",
      "category": "financing",
      "is_computed": true,
      "dependencies": [],
      "comment": "Negative = cash outflow"
    },
    {
      "code": "SHARE_ISSUANCE",
      "display_name": "Share Issuance",
      "level": 2,
      "formula": "driver:SHARE_ISSUANCE",
      "base_value_source": "driver:SHARE_ISSUANCE",
      "driver_applicable": true,
      "driver_code": "SHARE_ISSUANCE",
      "category": "financing",
      "is_computed": false,
      "dependencies": [],
      "comment": "Cash from issuing shares"
    },
    {
      "code": "CF_FINANCING",
      "display_name": "Net Cash from Financing Activities",
      "level": 0,
      "formula": "DEBT_ISSUANCE + DEBT_REPAYMENT + DIVIDENDS_PAID + SHARE_ISSUANCE",
      "base_value_source": null,
      "driver_applicable": false,
      "driver_code": null,
      "category": "subtotal",
      "is_computed": true,
      "dependencies": ["DEBT_ISSUANCE", "DEBT_REPAYMENT", "DIVIDENDS_PAID", "SHARE_ISSUANCE"]
    },
    {
      "code": "CF_NET",
      "display_name": "Net Change in Cash",
      "level": 0,
      "formula": "CF_OPERATING + CF_INVESTING + CF_FINANCING",
      "base_value_source": null,
      "driver_applicable": false,
      "driver_code": null,
      "category": "total",
      "is_computed": true,
      "dependencies": ["CF_OPERATING", "CF_INVESTING", "CF_FINANCING"]
    },
    {
      "code": "CASH_BEGINNING",
      "display_name": "Cash at Beginning of Period",
      "level": 0,
      "formula": "bs:CASH[t-1]",
      "base_value_source": null,
      "driver_applicable": false,
      "driver_code": null,
      "category": "total",
      "is_computed": true,
      "dependencies": ["bs:CASH"],
      "comment": "Opening cash from balance sheet"
    },
    {
      "code": "CASH_ENDING",
      "display_name": "Cash at End of Period",
      "level": 0,
      "formula": "CASH_BEGINNING + CF_NET",
      "base_value_source": null,
      "driver_applicable": false,
      "driver_code": null,
      "category": "total",
      "is_computed": true,
      "dependencies": ["CASH_BEGINNING", "CF_NET"],
      "comment": "Must equal bs:CASH"
    }
  ],
  "calculation_order": [
    "NET_INCOME",
    "DEPRECIATION",
    "AMORTIZATION",
    "CHANGE_ACCOUNTS_RECEIVABLE",
    "CHANGE_INVENTORY",
    "CHANGE_PREPAID_EXPENSES",
    "CHANGE_ACCOUNTS_PAYABLE",
    "CHANGE_ACCRUED_EXPENSES",
    "CF_OPERATING",
    "CAPEX",
    "ASSET_SALE_PROCEEDS",
    "CF_INVESTING",
    "DEBT_ISSUANCE",
    "DEBT_REPAYMENT",
    "DIVIDENDS_PAID",
    "SHARE_ISSUANCE",
    "CF_FINANCING",
    "CF_NET",
    "CASH_BEGINNING",
    "CASH_ENDING"
  ],
  "validation_rules": [
    {
      "rule_id": "CF001",
      "rule": "CASH_ENDING == bs:CASH",
      "severity": "error",
      "message": "Cash flow does not reconcile with balance sheet"
    },
    {
      "rule_id": "CF002",
      "rule": "CF_NET == CF_OPERATING + CF_INVESTING + CF_FINANCING",
      "severity": "error",
      "message": "Net cash flow does not equal sum of categories"
    },
    {
      "rule_id": "CF003",
      "rule": "CASH_ENDING == CASH_BEGINNING + CF_NET",
      "severity": "error",
      "message": "Cash reconciliation formula error"
    },
    {
      "rule_id": "CF004",
      "rule": "CF_OPERATING > 0",
      "severity": "warning",
      "message": "Negative operating cash flow"
    }
  ],
  "denormalized_columns": [
    "CF_OPERATING",
    "CF_INVESTING",
    "CF_FINANCING",
    "CF_NET",
    "CASH_BEGINNING",
    "CASH_ENDING"
  ],
  "metadata": {
    "method": "indirect",
    "supports_consolidation": true,
    "default_frequency": "monthly"
  }
}
