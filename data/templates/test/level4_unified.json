{
  "template_code": "TEST_UNIFIED_L4",
  "template_name": "Level 4: Unified Three-Statement Model with Working Capital",
  "statement_type": "unified",
  "industry": "TEST",
  "version": "1.0.0",
  "description": "Complete financial model: P&L → Working Capital → CF → BS in one DAG",
  "line_items": [
    {
      "code": "REVENUE",
      "display_name": "Revenue",
      "level": 1,
      "section": "profit_and_loss",
      "formula": null,
      "base_value_source": "driver:REVENUE",
      "is_computed": false,
      "sign_convention": "positive"
    },
    {
      "code": "COST_OF_GOODS_SOLD",
      "display_name": "Cost of Goods Sold",
      "level": 1,
      "section": "profit_and_loss",
      "formula": null,
      "base_value_source": "driver:COGS",
      "is_computed": false,
      "sign_convention": "negative"
    },
    {
      "code": "GROSS_PROFIT",
      "display_name": "Gross Profit",
      "level": 1,
      "section": "profit_and_loss",
      "formula": "REVENUE + COST_OF_GOODS_SOLD",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["REVENUE", "COST_OF_GOODS_SOLD"]
    },
    {
      "code": "DEPRECIATION",
      "display_name": "Depreciation Expense",
      "level": 2,
      "section": "profit_and_loss",
      "formula": null,
      "base_value_source": "driver:DEPRECIATION",
      "is_computed": false,
      "sign_convention": "negative"
    },
    {
      "code": "OPERATING_EXPENSES",
      "display_name": "Operating Expenses",
      "level": 2,
      "section": "profit_and_loss",
      "formula": null,
      "base_value_source": "driver:OPEX",
      "is_computed": false,
      "sign_convention": "negative"
    },
    {
      "code": "NET_INCOME",
      "display_name": "Net Income",
      "level": 1,
      "section": "profit_and_loss",
      "formula": "GROSS_PROFIT + OPERATING_EXPENSES + DEPRECIATION",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["GROSS_PROFIT", "OPERATING_EXPENSES", "DEPRECIATION"]
    },
    {
      "code": "CASH_COLLECTIONS",
      "display_name": "Cash Collections from Customers",
      "level": 3,
      "section": "working_capital",
      "formula": "REVENUE * 0.95",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["REVENUE"]
    },
    {
      "code": "ACCOUNTS_RECEIVABLE",
      "display_name": "Accounts Receivable",
      "level": 2,
      "section": "balance_sheet",
      "formula": "ACCOUNTS_RECEIVABLE[t-1] + REVENUE - CASH_COLLECTIONS",
      "base_value_source": "opening_bs:ACCOUNTS_RECEIVABLE",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["ACCOUNTS_RECEIVABLE[t-1]", "REVENUE", "CASH_COLLECTIONS"]
    },
    {
      "code": "DELTA_ACCOUNTS_RECEIVABLE",
      "display_name": "Change in Accounts Receivable",
      "level": 3,
      "section": "working_capital",
      "formula": "ACCOUNTS_RECEIVABLE - ACCOUNTS_RECEIVABLE[t-1]",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["ACCOUNTS_RECEIVABLE", "ACCOUNTS_RECEIVABLE[t-1]"]
    },
    {
      "code": "PURCHASES",
      "display_name": "Inventory Purchases",
      "level": 3,
      "section": "working_capital",
      "formula": "COST_OF_GOODS_SOLD * -1.1",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["COST_OF_GOODS_SOLD"]
    },
    {
      "code": "INVENTORY",
      "display_name": "Inventory",
      "level": 2,
      "section": "balance_sheet",
      "formula": "INVENTORY[t-1] + PURCHASES + COST_OF_GOODS_SOLD",
      "base_value_source": "opening_bs:INVENTORY",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["INVENTORY[t-1]", "PURCHASES", "COST_OF_GOODS_SOLD"]
    },
    {
      "code": "DELTA_INVENTORY",
      "display_name": "Change in Inventory",
      "level": 3,
      "section": "working_capital",
      "formula": "INVENTORY - INVENTORY[t-1]",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["INVENTORY", "INVENTORY[t-1]"]
    },
    {
      "code": "CASH_PAYMENTS",
      "display_name": "Cash Payments to Suppliers",
      "level": 3,
      "section": "working_capital",
      "formula": "PURCHASES * 0.90",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["PURCHASES"]
    },
    {
      "code": "ACCOUNTS_PAYABLE",
      "display_name": "Accounts Payable",
      "level": 2,
      "section": "balance_sheet",
      "formula": "ACCOUNTS_PAYABLE[t-1] + PURCHASES - CASH_PAYMENTS",
      "base_value_source": "opening_bs:ACCOUNTS_PAYABLE",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["ACCOUNTS_PAYABLE[t-1]", "PURCHASES", "CASH_PAYMENTS"]
    },
    {
      "code": "DELTA_ACCOUNTS_PAYABLE",
      "display_name": "Change in Accounts Payable",
      "level": 3,
      "section": "working_capital",
      "formula": "ACCOUNTS_PAYABLE - ACCOUNTS_PAYABLE[t-1]",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["ACCOUNTS_PAYABLE", "ACCOUNTS_PAYABLE[t-1]"]
    },
    {
      "code": "CASH_FLOW_OPERATING",
      "display_name": "Operating Cash Flow",
      "level": 1,
      "section": "cash_flow",
      "formula": "NET_INCOME - DEPRECIATION - DELTA_ACCOUNTS_RECEIVABLE - DELTA_INVENTORY + DELTA_ACCOUNTS_PAYABLE",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["NET_INCOME", "DEPRECIATION", "DELTA_ACCOUNTS_RECEIVABLE", "DELTA_INVENTORY", "DELTA_ACCOUNTS_PAYABLE"]
    },
    {
      "code": "CASH_FLOW_INVESTING",
      "display_name": "Investing Cash Flow",
      "level": 1,
      "section": "cash_flow",
      "formula": "0",
      "is_computed": true,
      "sign_convention": "positive"
    },
    {
      "code": "CASH_FLOW_FINANCING",
      "display_name": "Financing Cash Flow",
      "level": 1,
      "section": "cash_flow",
      "formula": "0",
      "is_computed": true,
      "sign_convention": "positive"
    },
    {
      "code": "CASH_FLOW_NET",
      "display_name": "Net Cash Flow",
      "level": 1,
      "section": "cash_flow",
      "formula": "CASH_FLOW_OPERATING + CASH_FLOW_INVESTING + CASH_FLOW_FINANCING",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["CASH_FLOW_OPERATING", "CASH_FLOW_INVESTING", "CASH_FLOW_FINANCING"]
    },
    {
      "code": "CASH_BEGINNING",
      "display_name": "Cash at Beginning of Period",
      "level": 2,
      "section": "cash_flow",
      "formula": "CASH[t-1]",
      "base_value_source": "opening_bs:CASH",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["CASH[t-1]"]
    },
    {
      "code": "CASH_ENDING",
      "display_name": "Cash at End of Period",
      "level": 2,
      "section": "cash_flow",
      "formula": "CASH_BEGINNING + CASH_FLOW_NET",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["CASH_BEGINNING", "CASH_FLOW_NET"]
    },
    {
      "code": "CASH",
      "display_name": "Cash",
      "level": 2,
      "section": "balance_sheet",
      "formula": "CASH[t-1] + CASH_FLOW_NET",
      "base_value_source": "opening_bs:CASH",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["CASH[t-1]", "CASH_FLOW_NET"]
    },
    {
      "code": "TOTAL_CURRENT_ASSETS",
      "display_name": "Total Current Assets",
      "level": 1,
      "section": "balance_sheet",
      "formula": "CASH + ACCOUNTS_RECEIVABLE + INVENTORY",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["CASH", "ACCOUNTS_RECEIVABLE", "INVENTORY"]
    },
    {
      "code": "FIXED_ASSETS",
      "display_name": "Fixed Assets (Net)",
      "level": 2,
      "section": "balance_sheet",
      "formula": "FIXED_ASSETS[t-1] + DEPRECIATION",
      "base_value_source": "opening_bs:FIXED_ASSETS",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["FIXED_ASSETS[t-1]", "DEPRECIATION"]
    },
    {
      "code": "TOTAL_ASSETS",
      "display_name": "Total Assets",
      "level": 1,
      "section": "balance_sheet",
      "formula": "TOTAL_CURRENT_ASSETS + FIXED_ASSETS",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["TOTAL_CURRENT_ASSETS", "FIXED_ASSETS"]
    },
    {
      "code": "TOTAL_CURRENT_LIABILITIES",
      "display_name": "Total Current Liabilities",
      "level": 1,
      "section": "balance_sheet",
      "formula": "ACCOUNTS_PAYABLE",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["ACCOUNTS_PAYABLE"]
    },
    {
      "code": "TOTAL_LIABILITIES",
      "display_name": "Total Liabilities",
      "level": 1,
      "section": "balance_sheet",
      "formula": "TOTAL_CURRENT_LIABILITIES",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["TOTAL_CURRENT_LIABILITIES"]
    },
    {
      "code": "RETAINED_EARNINGS",
      "display_name": "Retained Earnings",
      "level": 2,
      "section": "balance_sheet",
      "formula": "RETAINED_EARNINGS[t-1] + NET_INCOME",
      "base_value_source": "opening_bs:RETAINED_EARNINGS",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["RETAINED_EARNINGS[t-1]", "NET_INCOME"]
    },
    {
      "code": "TOTAL_EQUITY",
      "display_name": "Total Equity",
      "level": 1,
      "section": "balance_sheet",
      "formula": "RETAINED_EARNINGS",
      "is_computed": true,
      "sign_convention": "positive",
      "dependencies": ["RETAINED_EARNINGS"]
    }
  ]
}
