{
  "template_code": "TEST_UNIFIED_L10",
  "template_name": "Level 10: Carbon Financial Integration Test",
  "statement_type": "unified",
  "description": "Level 10 progressive test: Integrates carbon cost into P&L, carbon allowances into BS with rollforward logic",
  "version": "1.0.0",
  "line_items": [
    {
      "code": "REVENUE",
      "display_name": "Revenue (€)",
      "statement_type": "pl",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:REVENUE",
      "is_computed": false,
      "sign_convention": "positive",
      "unit": "EUR",
      "dependencies": []
    },
    {
      "code": "COST_OF_GOODS_SOLD",
      "display_name": "Cost of Goods Sold (€)",
      "statement_type": "pl",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:COST_OF_GOODS_SOLD",
      "is_computed": false,
      "sign_convention": "negative",
      "unit": "EUR",
      "dependencies": []
    },
    {
      "code": "GROSS_PROFIT",
      "display_name": "Gross Profit (€)",
      "statement_type": "pl",
      "level": 2,
      "formula": "REVENUE - COST_OF_GOODS_SOLD",
      "is_computed": true,
      "sign_convention": "positive",
      "unit": "EUR",
      "dependencies": ["REVENUE", "COST_OF_GOODS_SOLD"]
    },
    {
      "code": "OPERATING_EXPENSES",
      "display_name": "Operating Expenses (€)",
      "statement_type": "pl",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:OPERATING_EXPENSES",
      "is_computed": false,
      "sign_convention": "negative",
      "unit": "EUR",
      "dependencies": []
    },
    {
      "code": "DEPRECIATION",
      "display_name": "Depreciation (€)",
      "statement_type": "pl",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:DEPRECIATION",
      "is_computed": false,
      "sign_convention": "negative",
      "unit": "EUR",
      "dependencies": []
    },
    {
      "code": "EBIT",
      "display_name": "EBIT (€)",
      "statement_type": "pl",
      "level": 2,
      "formula": "GROSS_PROFIT - OPERATING_EXPENSES - DEPRECIATION",
      "is_computed": true,
      "sign_convention": "positive",
      "unit": "EUR",
      "dependencies": ["GROSS_PROFIT", "OPERATING_EXPENSES", "DEPRECIATION"]
    },
    {
      "code": "INTEREST_EXPENSE",
      "display_name": "Interest Expense (€)",
      "statement_type": "pl",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:INTEREST_EXPENSE",
      "is_computed": false,
      "sign_convention": "negative",
      "unit": "EUR",
      "dependencies": []
    },
    {
      "code": "CARBON_TAX_EXPENSE",
      "display_name": "Carbon Tax Expense (€)",
      "statement_type": "pl",
      "level": 1,
      "formula": "CARBON_COST",
      "is_computed": true,
      "sign_convention": "negative",
      "unit": "EUR",
      "dependencies": ["CARBON_COST"],
      "comment": "Cross-statement: references carbon cost"
    },
    {
      "code": "EBT",
      "display_name": "Earnings Before Tax (€)",
      "statement_type": "pl",
      "level": 2,
      "formula": "EBIT - INTEREST_EXPENSE - CARBON_TAX_EXPENSE",
      "is_computed": true,
      "sign_convention": "positive",
      "unit": "EUR",
      "dependencies": ["EBIT", "INTEREST_EXPENSE", "CARBON_TAX_EXPENSE"]
    },
    {
      "code": "TAX_EXPENSE",
      "display_name": "Tax Expense (€)",
      "statement_type": "pl",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:TAX_EXPENSE",
      "is_computed": false,
      "sign_convention": "negative",
      "unit": "EUR",
      "dependencies": []
    },
    {
      "code": "NET_INCOME",
      "display_name": "Net Income (€)",
      "statement_type": "pl",
      "level": 2,
      "formula": "EBT - TAX_EXPENSE",
      "is_computed": true,
      "sign_convention": "positive",
      "unit": "EUR",
      "dependencies": ["EBT", "TAX_EXPENSE"]
    },
    {
      "code": "CASH",
      "display_name": "Cash (€)",
      "statement_type": "bs",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:CASH",
      "is_computed": false,
      "sign_convention": "positive",
      "unit": "EUR",
      "dependencies": []
    },
    {
      "code": "ACCOUNTS_RECEIVABLE",
      "display_name": "Accounts Receivable (€)",
      "statement_type": "bs",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:ACCOUNTS_RECEIVABLE",
      "is_computed": false,
      "sign_convention": "positive",
      "unit": "EUR",
      "dependencies": []
    },
    {
      "code": "INVENTORY",
      "display_name": "Inventory (€)",
      "statement_type": "bs",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:INVENTORY",
      "is_computed": false,
      "sign_convention": "positive",
      "unit": "EUR",
      "dependencies": []
    },
    {
      "code": "PPE_NET",
      "display_name": "Property, Plant & Equipment - Net (€)",
      "statement_type": "bs",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:PPE_NET",
      "is_computed": false,
      "sign_convention": "positive",
      "unit": "EUR",
      "dependencies": []
    },
    {
      "code": "TOTAL_ASSETS",
      "display_name": "Total Assets (€)",
      "statement_type": "bs",
      "level": 2,
      "formula": "CASH + ACCOUNTS_RECEIVABLE + INVENTORY + PPE_NET",
      "is_computed": true,
      "sign_convention": "positive",
      "unit": "EUR",
      "dependencies": ["CASH", "ACCOUNTS_RECEIVABLE", "INVENTORY", "PPE_NET"]
    },
    {
      "code": "ACCOUNTS_PAYABLE",
      "display_name": "Accounts Payable (€)",
      "statement_type": "bs",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:ACCOUNTS_PAYABLE",
      "is_computed": false,
      "sign_convention": "negative",
      "unit": "EUR",
      "dependencies": []
    },
    {
      "code": "DEBT",
      "display_name": "Debt (€)",
      "statement_type": "bs",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:DEBT",
      "is_computed": false,
      "sign_convention": "negative",
      "unit": "EUR",
      "dependencies": []
    },
    {
      "code": "RETAINED_EARNINGS",
      "display_name": "Retained Earnings (€)",
      "statement_type": "bs",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:RETAINED_EARNINGS",
      "is_computed": false,
      "sign_convention": "positive",
      "unit": "EUR",
      "dependencies": []
    },
    {
      "code": "TOTAL_LIABILITIES_EQUITY",
      "display_name": "Total Liabilities & Equity (€)",
      "statement_type": "bs",
      "level": 2,
      "formula": "ACCOUNTS_PAYABLE + DEBT + RETAINED_EARNINGS",
      "is_computed": true,
      "sign_convention": "positive",
      "unit": "EUR",
      "dependencies": ["ACCOUNTS_PAYABLE", "DEBT", "RETAINED_EARNINGS"]
    },
    {
      "code": "CASH_FLOW_OPERATING",
      "display_name": "Cash Flow from Operations (€)",
      "statement_type": "cf",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:CASH_FLOW_OPERATING",
      "is_computed": false,
      "sign_convention": "positive",
      "unit": "EUR",
      "dependencies": []
    },
    {
      "code": "CASH_FLOW_INVESTING",
      "display_name": "Cash Flow from Investing (€)",
      "statement_type": "cf",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:CASH_FLOW_INVESTING",
      "is_computed": false,
      "sign_convention": "negative",
      "unit": "EUR",
      "dependencies": []
    },
    {
      "code": "CASH_FLOW_FINANCING",
      "display_name": "Cash Flow from Financing (€)",
      "statement_type": "cf",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:CASH_FLOW_FINANCING",
      "is_computed": false,
      "sign_convention": "positive",
      "unit": "EUR",
      "dependencies": []
    },
    {
      "code": "CASH_FLOW_NET",
      "display_name": "Net Cash Flow (€)",
      "statement_type": "cf",
      "level": 2,
      "formula": "CASH_FLOW_OPERATING + CASH_FLOW_INVESTING + CASH_FLOW_FINANCING",
      "is_computed": true,
      "sign_convention": "positive",
      "unit": "EUR",
      "dependencies": ["CASH_FLOW_OPERATING", "CASH_FLOW_INVESTING", "CASH_FLOW_FINANCING"]
    },
    {
      "code": "SCOPE1_EMISSIONS",
      "display_name": "Scope 1 Emissions (tCO2e)",
      "statement_type": "carbon",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:SCOPE1_EMISSIONS",
      "is_computed": false,
      "sign_convention": "positive",
      "unit": "tCO2e",
      "dependencies": []
    },
    {
      "code": "SCOPE2_EMISSIONS",
      "display_name": "Scope 2 Emissions (tCO2e)",
      "statement_type": "carbon",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:SCOPE2_EMISSIONS",
      "is_computed": false,
      "sign_convention": "positive",
      "unit": "tCO2e",
      "dependencies": []
    },
    {
      "code": "SCOPE3_EMISSIONS",
      "display_name": "Scope 3 Emissions (tCO2e)",
      "statement_type": "carbon",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:SCOPE3_EMISSIONS",
      "is_computed": false,
      "sign_convention": "positive",
      "unit": "tCO2e",
      "dependencies": []
    },
    {
      "code": "TOTAL_EMISSIONS",
      "display_name": "Total Emissions (tCO2e)",
      "statement_type": "carbon",
      "level": 2,
      "formula": "SCOPE1_EMISSIONS + SCOPE2_EMISSIONS + SCOPE3_EMISSIONS",
      "is_computed": true,
      "sign_convention": "positive",
      "unit": "tCO2e",
      "dependencies": ["SCOPE1_EMISSIONS", "SCOPE2_EMISSIONS", "SCOPE3_EMISSIONS"]
    },
    {
      "code": "EMISSION_INTENSITY",
      "display_name": "Emission Intensity (tCO2e per €1M revenue)",
      "statement_type": "carbon",
      "level": 3,
      "formula": "TOTAL_EMISSIONS / (REVENUE / 1000000)",
      "is_computed": true,
      "sign_convention": "positive",
      "unit": "tCO2e/€M",
      "dependencies": ["TOTAL_EMISSIONS", "REVENUE"],
      "comment": "Cross-statement dependency: references P&L revenue"
    },
    {
      "code": "CARBON_PRICE",
      "display_name": "Carbon Price (€/tCO2e)",
      "statement_type": "carbon",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:CARBON_PRICE",
      "is_computed": false,
      "sign_convention": "positive",
      "unit": "€/tCO2e",
      "dependencies": []
    },
    {
      "code": "CARBON_COST",
      "display_name": "Carbon Cost (€)",
      "statement_type": "carbon",
      "level": 2,
      "formula": "TOTAL_EMISSIONS * CARBON_PRICE",
      "is_computed": true,
      "sign_convention": "positive",
      "unit": "EUR",
      "dependencies": ["TOTAL_EMISSIONS", "CARBON_PRICE"]
    },
    {
      "code": "ALLOWANCES_PURCHASED",
      "display_name": "Allowances Purchased (tCO2e)",
      "statement_type": "carbon",
      "level": 1,
      "formula": null,
      "base_value_source": "driver:ALLOWANCES_PURCHASED",
      "is_computed": false,
      "sign_convention": "positive",
      "unit": "tCO2e",
      "dependencies": []
    },
    {
      "code": "CARBON_ALLOWANCES_HELD",
      "display_name": "Carbon Allowances Held (tCO2e)",
      "statement_type": "carbon",
      "level": 3,
      "formula": "CARBON_ALLOWANCES_HELD[t-1] + ALLOWANCES_PURCHASED - TOTAL_EMISSIONS",
      "is_computed": true,
      "sign_convention": "positive",
      "unit": "tCO2e",
      "dependencies": ["CARBON_ALLOWANCES_HELD[t-1]", "ALLOWANCES_PURCHASED", "TOTAL_EMISSIONS"],
      "comment": "Rollforward like BS asset"
    }
  ]
}
